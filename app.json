{
  "id": "no.almli.flexit",
  "version": "0.0.1",
  "compatibility": ">=2.0.5",
  "sdk": 2,
  "brandColor": "#039FE3",
  "name": {
    "en": "Flexit SP30 panel"
  },
  "description": {
    "en": "App to control Flexit ventilation with SP30 panels."
  },
  "category": [
    "climate"
  ],
  "tags": {
    "en": [
      "flexit",
      "sp30",
      "ventilation"
    ]
  },
  "permissions": [
    "homey:manager:api"
  ],
  "images": {
    "large": "/assets/images/large.png",
    "small": "/assets/images/small.png"
  },
  "author": {
    "name": "Bjørnar Almli",
    "email": "bjornar.almli@gmail.com"
  },
  "contributors": {
    "developers": [
      {
        "name": "Bjørnar Almli",
        "email": "bjornar.almli@gmail.com"
      }
    ]
  },
  "flow": {
    "triggers": [
      {
        "id": "fan_level_changed",
        "title": {
          "en": "Fan level changed"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=FlexitSP30"
          }
        ],
        "tokens": [
          {
            "name": "value",
            "type": "string",
            "title": {
              "en": "Fan level"
            },
            "example": "Normal"
          },
          {
            "name": "from_panel",
            "type": "boolean",
            "title": {
              "en": "From panel"
            },
            "example": false
          }
        ]
      },
      {
        "id": "heating_changed",
        "title": {
          "en": "Heating changed"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=FlexitSP30"
          }
        ],
        "tokens": [
          {
            "name": "value",
            "type": "string",
            "title": {
              "en": "Heating"
            },
            "example": "Off"
          },
          {
            "name": "from_panel",
            "title": {
              "en": "From panel"
            },
            "type": "boolean",
            "example": false
          }
        ]
      }
    ],
    "conditions": [
      {
        "id": "is_fan_level",
        "title": {
          "en": "Is fan level"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=FlexitSP30"
          },
          {
            "type": "dropdown",
            "name": "fan_level",
            "values": [
              {
                "id": "Minimum",
                "label": {
                  "en": "Minimum"
                }
              },
              {
                "id": "Normal",
                "label": {
                  "en": "Normal"
                }
              },
              {
                "id": "Maximum",
                "label": {
                  "en": "Maximum"
                }
              }
            ]
          }
        ]
      },
      {
        "id": "is_heating",
        "title": {
          "en": "Is heating !{{on|off}}"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=FlexitSP30"
          }
        ]
      }
    ],
    "actions": [
      {
        "id": "set_mode",
        "title": {
          "en": "Set mode"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=FlexitSP30"
          },
          {
            "type": "dropdown",
            "name": "mode",
            "values": [
              {
                "id": "min",
                "label": {
                  "en": "Minimum"
                }
              },
              {
                "id": "normal",
                "label": {
                  "en": "Normal"
                }
              },
              {
                "id": "max",
                "label": {
                  "en": "Maximum"
                }
              },
              {
                "id": "normal_heat",
                "label": {
                  "en": "Normal/Heat"
                }
              },
              {
                "id": "max_heat",
                "label": {
                  "en": "Maximum/Heat"
                }
              }
            ]
          }
        ]
      }
    ]
  },
  "drivers": [
    {
      "id": "FlexitSP30",
      "name": {
        "en": "Flexit SP30"
      },
      "zwave": {
        "manufacturerId": 277,
        "productTypeId": 273,
        "productId": 49344,
        "productDocumentation": "",
        "imageRemotePath": "",
        "learnmode": {
          "image": "/drivers/FlexitSP30/assets/learnmode.svg",
          "instruction": {
            "en": "Press the button on your Z-UNO three times"
          }
        },
        "unlearnmode": {
          "image": "/drivers/FlexitSP30/assets/learnmode.svg",
          "instruction": {
            "en": "Press the button on your Z-UNO three times"
          }
        },
        "associationGroups": [
        ],
        "associationGroupsMultiChannel": [
          1,
          2,
          3,
          4,
          5,
          6
        ],
        "associationGroupsOptions": {
          "1": {
            "hint": {
              "en": "Mode for fan level and heating"
            }
          },
          "2": {
            "hint": {
              "en": "Status for fan level"
            }
          },
          "3": {
            "hint": {
              "en": "Status for heating"
            }
          },
          "4": {
            "hint": {
              "en": "Temperature air from outside reporting"
            }
          },
          "5": {
            "hint": {
              "en": "Temperature air to outside reporting"
            }
          },
          "6": {
            "hint": {
              "en": "Temperature air to house reporting"
            }
          },
          "7": {
            "hint": {
              "en": "Temperature air from house reporting"
            }
          }
        }
      },
      "class": "fan",
      "capabilities": [
        "mode",
        "fan_level_report",
        "heating_report",
        "measure_temperature.bath",
        "measure_humidity.bath",
        "measure_temperature.in",
        "measure_temperature.out",
        "measure_temperature.house_in",
        "measure_temperature.house_out",
        "prev_fan_level_report",
        "usage_normal_per_day",
        "usage_max_per_day"
      ],
      "capabilitiesOptions": {
        "measure_temperature.bath": {
          "title": "Temperature bath",
          "insights": false
        },
        "measure_humidity.bath": {
          "title": "Humidity bath",
          "insights": false
        },
        "measure_temperature.in": {
          "title": "Air from outside"
        },
        "measure_temperature.out": {
          "title": "Air to outside"
        },
        "measure_temperature.house_in": {
          "title": "Air to house"
        },
        "measure_temperature.house_out": {
          "title": "Air from house"
        }
      },
      "settings": [
        {
          "type": "group",
          "label": {
            "en": "Device specific"
          },
          "children": [
            {
              "id": "Status_report_interval",
              "zwave": {
                "index": 64,
                "size": 2
              },
              "type": "number",
              "attr": {
                "min": 0,
                "max": 32767
              },
              "value": 30,
              "label": {
                "en": "Fan level and heating status report interval (s)"
              },
              "hint": {
                "en": "Time interval between consecutive status reports. \nZ-wave parameter 64 \nRange: 0, 30 - 32767 (s)\nDefault: 60 (s)"
              }
            },
            {
              "id": "Temperature_report_interval",
              "zwave": {
                "index": 65,
                "size": 2
              },
              "type": "number",
              "attr": {
                "min": 0,
                "max": 32767
              },
              "value": 60,
              "label": {
                "en": "Temperature report interval (s)"
              },
              "hint": {
                "en": "Time interval between consecutive temperature reports. \nZ-wave parameter 65 \nRange: 0, 30 - 32767 (s)\nDefault: 60 (s)"
              }
            },
            {
              "id": "Temperature_report_threshold",
              "zwave": {
                "index": 66,
                "size": 2
              },
              "type": "number",
              "attr": {
                "min": 0,
                "max": 100
              },
              "value": 2,
              "label": {
                "en": "Temperature report threshold (°C)"
              },
              "hint": {
                "en": "The temperature report will be sent if there is a difference in temperature value from the previous value reported (threshold). \nZ-wave parameter 66 \nRange: 0 - 100 (0 - 10.0 °C)\nDefault: 2 (0.2 °C)"
              }
            },
            {
              "id": "Relay_duration",
              "zwave": {
                "index": 67,
                "size": 2
              },
              "type": "number",
              "attr": {
                "min": 50,
                "max": 5000
              },
              "value": 500,
              "label": {
                "en": "Relay on duration (ms)"
              },
              "hint": {
                "en": "Duration to keep the relay on when switching. \nZ-wave parameter 67 \nRange: 50 - 5000 \nDefault: 500 (ms)"
              }
            }
          ]
        },
        {
          "type": "group",
          "label": {
            "en": "Sensor calibration"
          },
          "collapsed": true,
          "children": [
            {
              "id": "Temp1_sensor_calibration",
              "zwave": {
                "index": 70,
                "size": 2
              },
              "type": "number",
              "attr": {
                "min": -400,
                "max": 400
              },
              "value": 0,
              "label": {
                "en": "Air from outside temperature sensor calibration (°C)"
              },
              "hint": {
                "en": "Temperature sensor 'Air from outside' calibration. \nZ-wave parameter 70 \nRange: -400 - 400 (-4.0 - 4.0°C)\nDefault: 0"
              }
            },
            {
              "id": "Temp2_sensor_calibration",
              "zwave": {
                "index": 71,
                "size": 2
              },
              "type": "number",
              "attr": {
                "min": -400,
                "max": 400
              },
              "value": 0,
              "label": {
                "en": "Air to outside temperature sensor calibration (°C)"
              },
              "hint": {
                "en": "Temperature sensor 'Air to outside' calibration. \nZ-wave parameter 71 \nRange: -400 - 400 (-4.0 - 4.0°C)\nDefault: 0"
              }
            },
            {
              "id": "Temp3_sensor_calibration",
              "zwave": {
                "index": 72,
                "size": 2
              },
              "type": "number",
              "attr": {
                "min": -400,
                "max": 400
              },
              "value": 0,
              "label": {
                "en": "Air to house temperature sensor calibration (°C)"
              },
              "hint": {
                "en": "Temperature sensor 'Air to house' calibration. \nZ-wave parameter 72 \nRange: -400 - 400 (-4.0 - 4.0°C)\nDefault: 0"
              }
            },
            {
              "id": "Temp4_sensor_calibration",
              "zwave": {
                "index": 73,
                "size": 2
              },
              "type": "number",
              "attr": {
                "min": -400,
                "max": 400
              },
              "value": 0,
              "label": {
                "en": "Air from house temperature sensor calibration (°C)"
              },
              "hint": {
                "en": "Temperature sensor 'Air from house' calibration. \nZ-wave parameter 73 \nRange: -400 - 400 (-4.0 - 4.0°C)\nDefault: 0"
              }
            }
          ]
        },
        {
          "type": "group",
          "label": {
            "en": "Bathroom device"
          },
          "children": [
            {
              "id": "bathRoomDevice",
              "type": "text",
              "label": {
                "en": "Bathroom device"
              },
              "value": "Badet temp"
            },
            {
              "id": "bathRoomDevice_report_interval",
              "type": "number",
              "attr": {
                "min": 0,
                "max": 32767
              },
              "value": 60,
              "label": {
                "en": "Bathroom device report interval (s)"
              },
              "hint": {
                "en": "Time interval between consecutive bathroom device reports. \nRange: 0, 30 - 32767 (s)\nDefault: 60 (s)"
              }
            }
          ]
        }
      ],
      "images": {
        "large": "/drivers/FlexitSP30/assets/images/large.png",
        "small": "/drivers/FlexitSP30/assets/images/small.png"
      }
    }
  ],
  "capabilities": {
    "mode": {
      "type": "enum",
      "title": {
        "en": "Mode"
      },
      "insights": false,
      "desc": {
        "en": "Mode"
      },
      "values": [
        {
          "id": "min",
          "title": {
            "en": "Minimum"
          }
        },
        {
          "id": "normal",
          "title": {
            "en": "Normal"
          }
        },
        {
          "id": "max",
          "title": {
            "en": "Maximum"
          }
        },
        {
          "id": "normal_heat",
          "title": {
            "en": "Normal/Heat"
          }
        },
        {
          "id": "max_heat",
          "title": {
            "en": "Maximum/Heat"
          }
        }
      ],
      "getable": true,
      "setable": true,
      "uiComponent": "picker"
    },
    "fan_level_report": {
      "type": "string",
      "title": {
        "en": "Fan level"
      },
      "insights": false,
      "desc": {
        "en": "Fan level"
      },
      "getable": true,
      "setable": false,
      "uiComponent": "sensor"
    },
    "prev_fan_level_report": {
      "type": "string",
      "title": {
        "en": "Previous fan level"
      },
      "insights": false,
      "getable": true,
      "setable": false,
      "uiComponent": null
    },
    "heating_report": {
      "type": "string",
      "title": {
        "en": "Heating"
      },
      "insights": false,
      "desc": {
        "en": "Heating"
      },
      "getable": true,
      "setable": false,
      "uiComponent": "sensor"
    },
    "usage_normal_per_day": {
      "type": "number",
      "title": {
        "en": "Usage 'Normal' per day"
      },
      "units": {
        "en": "s"
      },
      "insights": true,
      "desc": {
        "en": "Usage 'Normal' per day (seconds)"
      },
      "getable": true,
      "setable": false,
      "uiComponent": null
    },
    "usage_max_per_day": {
      "type": "number",
      "title": {
        "en": "Usage 'Maximum' per day"
      },
      "units": {
        "en": "s"
      },
      "insights": true,
      "desc": {
        "en": "Usage 'Maximum' per day (seconds)"
      },
      "getable": true,
      "setable": false,
      "uiComponent": null
    }
  }
}